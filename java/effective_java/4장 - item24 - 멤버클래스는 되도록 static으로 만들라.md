# item 24 - 멤버 클래스는 되도록 static으로 만들라

## 핵심정리

> 중첩 클래스에는 네가지가 있으며 각각의 쓰임이 다르다. 메서드 밖에서도 사용해야 하거나 메서드 안에 정의하기엔 너무 길다면 멤버 클래스로 만든다. 멤버 클래스의 인스턴스 각각이 바깥 인스턴스를 참조한다면  
>
> - 멤버 클래스의 인스턴스 각각이 바깥인스턴스를 참조한다면  
>   비정적(non-static)으로,
> - 그렇지 않으면  
>   정적(static)으로
>
> 만든다.  
>
> 중첩 클래스가 
>
> - 한 메서드 안에서만 쓰이면서 그 인스턴스를 생성하는 지점이 단 한곳이고, 해당 타입으로 쓰기에 적합한 클래스나 인터페이스가 이미 있다면 
>   익명 클래스로 만들고 
> - 그렇지 않으면 
>   지역 클래스로 만들자.



## overview

이 주제를 시작하면서 중첩 클래스에 대해 먼저 언급하고 있다.  

>  중첩 클래스(nested class) 란? 
>
> - 다른 클래스 안에 정의된 클래스
> - 자신을 감싼 바깥 클래스에서만 쓰인다.
> - 그 외의 쓰임새가 있다면 톱 레벨 클래스로 만든다.



> 중첩 클래스의 종류
>
> - static (정적) 멤버 클래스
> - non-static (비정적) 멤버 클래스
> - 익명 클래스
> - 지역 클래스

  

이중 첫번째(정적 멤버 클래스)를 제외한 나머지는 내부 클래스(inner class)이다.  

이론적으로 생각해보면 당연한 이야기이다. 외우려 하기엔 어렵다. static 클래스는 일반 클래스와는 스코프가 다르기 때문이다. 선언한 클래스 내에 속하는 것이 아니라 컴파일 타임 영역에 포함된다고 분류할 수 있기 때문이다. 이런 이유로 static 클래스가 inner class에 포함되지 않는다는 표현을 한 것으로 보인다. (굳이 이렇게 분류해놓고 이야기 할 필요는 없는 것으로 보이지만...)  



중첩 클래스의 종류에는 네가지가 있는데 이중 멤버 클래스인 것은   

- 정적 멤버 클래스  (static 멤버 클래스)
- 비 정적 멤버 클래스 (static 이 붙지 않은 멤버 클래스)  

이다.  

그러면서 정적 멤버클래스와 비 정적 멤버 클래스의 차이와 활용의 차이를 설명한다. 이 외에도 중첩클래스의 다른 종류인 익명 클래스와 지역 클래스에 대해서도 활용에 대해 설명한다. (멤버 클래스란, 한 클래스의 멤버 이면서, 타입이 클래스인 녀석들을 이야기 하는 것이라고 이해하면 될듯 하다.)

  

이제 여기서부터는 중첩 클래스의 종류중 

- static (정적) 멤버 클래스
- non-static (비정적) 멤버 클래스

의 차이를 설명하고, non-static 멤버 클래스를 사용할 경우의 취약점에 대해 설명한다. 그리고 취약점이 있긴하미만 언제 non-static을 사용하는지 예를 들기도 한다.



# 정적 멤버 클래스

- 다른 클래스 내에 선언되고
- 바깥 클래스의 private 멤버에도 접근할수 있다



>  정적 멤버 클래스는 
>
> - 다른 정적 멤버와 똑같은 접근규칙을 적용받는다. 예를 들면 private으로 선언했을 때 바깥 클래스에서만 접근할수 잇는 것을 예로 들수 있다.
> - 주로 바깥 클래스와 함께 쓰일때만 유용한 public 도우미 클래스로 자주 쓰인다.
> - 아이템34 (enum 기본예)를 예로 들수 있다. 



참고)

> Operation enum 타입은   
>
> Calculator클래스의 public 정적 멤버 클래스가 되어야 한다.  
>
> (Calculator.Operation.PLUS, Calculator.Operation.MINUS)와 같은 형태로 원하는 연산을 참조할 수 있다.)

  

## private static 멤버 클래스(정적 멤버 클래스)

 : 흔히 바깥 클래스가 표현하는 객체의 한 부분(구성 요소)을 나타낼 때 쓴다.

키와 값을 매핑 시키는 Map 인스턴스를 예로 들고 있다.

보통 Map 구현체는 각각의 키-값 쌍을 표현하는 엔트리(Entry) 객체들을 가지고 있다. 모든 엔트리는 맵하고 연관된다. 하지만 엔트리의 메서드들(getKey, getValue, setValue)은 맵을 직접 사용하지 않는다.

엔트리를 non-static 멤버 클래스로 표현하는 것은 낭비이고

private static 멤버 클래스가 가장 알맞다.

(만약 non static으로 선언할 경우 모든 엔트리가 바깥 맵으로의 참조를 가지므로 공간과 시간을 낭비한다.)

멤버 클래스가 공개된 클래스의 public 또는 private 일때 static이냐 아니냐는 두배로 더 중요해진다. 멤버 클래스 역시 공개 API가 되므로 혹시라도 향후 릴리스에서 static을 붙이면 하위 호환성이 깨진다.

# non-static 멤버 클래스 (비정적 멤버 클래스)

- 바깥 클래스의 인스턴스와 암묵적으로 연결되는데, static이 아닌 멤버 클래스 내부의 메서드에서 정규화된 this로 바깥인스턴스의 메서드를 호출하거나 바깥 인스턴스의 참조를 가져오는것이 가능해진다.

  

- 정규화된 this란 클래스명.this 형태로 클래스의 이름을 명시하는 용법이다.

  (JLS, 15.8.4)

  

- static을 생략하면 바깥인스턴스로의 숨은 외부 참조를 갖게 되는데 이 참조를 저장하고 있으려면 시간과 공간이 소비되고,

  

- 더 심각한 문제는 가비지 컬렉션이 바깥 클래스의 인스턴스를 수거하지 못하는 메모리 누수가 생길수 있다는 점이다 (아이템 7 - 다쓴 객체 참조를 해제하라).

  

- 바깥 인스턴스를 참조해 여러가지 동작을 할 수 있는 이런 문제로 인해 가능하다면 멤버 클래스는 static(정적)으로 만들어야 한다고 한다. 

  

- non-static 멤버 클래스는 바깥 인스턴스 없이는 생성할 수 없다.

따라서 개념상 중첩 클래스의 인스턴스가 바깥 인스턴스와 독립적으로 존재할 수 있다면 static 멤버 클래스로 만들어야 한다.  

비 정적(non-static) 멤버 클래스를 사용하는 경우는 어댑터(Gamma95)를 정의할때 자주 쓰인다고 한다.  

어댑터는 어떤 클래스의 인스턴스를 감싸 다른 클래스의 인스턴스 처럼 보이게 하는 뷰로 사용하는 것이다.  

예제) non-static 비정적 멤버 클래스 사용예 - 자기 자신의 반복자 구현

```java
public class MySet<E> extends AbstractSet<E>{
    … // 생략
    @Override public Iterator<E> iterator(){
        return new MyIterator();
    }

    private class MyIterator implements Iterator<E>{
        …
    }
}
```



위에서 살펴본 non-static 클래스의

- 바깥 인스턴스를 참조할 수도 있는 문제점
- 가비지 컬렉션이 바깥 클래스의 인스턴스를 수거하지 못하는 메모리 누수

문제점으로 인해 또 아래의 내용을 강조한다.  

이런  문제로 인해 멤버 클래스 안에서 바깥 인스턴스에 접근할 필요가 없으면 (그럴 경우에는)  

무조건 static을 붙여서 정적 멤버 클래스로 만들어야 한다. (되게 여러번 강조하고 있다. 또 강조했다.)  

  

그러면서 private static 멤버 클래스(정적 멤버 클래스)를 설명하는데 이에 대해서는 **정적 멤버 클래스** 에 정리해두었다.



# 익명 클래스

자바가 람다를 지원하기 전에는 즉석에서 작은 함수 객체나 처리 객체(process object)를 만드는데에 익명 클래스를 주로 사용했다. 이제는 람다에게 그 자리를 물려줬다.(아이템 42 - 익명 클래스보다는 람다를 사용하라)  

익명 클래스는 정적 팩터리 메서드를  구현할 때 자주 쓰이는 편이다( 참고. 코드 20-1의 intArrayAsList ).



# 지역 클래스

중첩 클래스의 네가지 종류 중 가장 드물게 사용된다. 지역 클래스는 지역 변수를 선언할 수 있는 곳이면 실질적으로 어디서든 선언할 수있다. 유효범위도 지역변수와 같다. 익명 클래스처럼 non-static 문맥에서 사용될때만 바깐 인스턴스를 참조할 수 있다. 정적 멤버는 가질수 없으며 가독성을 위해 짧게 작성해야 한다.  


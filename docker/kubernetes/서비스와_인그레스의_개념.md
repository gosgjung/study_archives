# 쿠버네티스 서비스의 개념

클러스터 안의 Pod들은  IP가 주기적으로 변경된다. Pod이 삭제되기도 하고, 클러스터 안을 옮겨다니기 때문이다. 클러스터 안에서 이동하게 되면서 클러스터 내부에서의 IP가 변경되기도 한다. 이렇게 계속 IP가 변하면 파드에 접속할 방법이 어려울 수 있다. 이런 경우에 대해 동적으로 변하는 Pod들에 대해 고정적으로 접근하려 할때 쿠버네티스의 서비스를 사용한다.  

  

# 1. 서비스 vs 인그레스

서비스를 사용하면 쿠버네티스 클러스터 내에서 Pod에 대해 고정주소로 접근 가능하다. 클러스터 외부에서 클러스터 내부의 Pod로 접근 또한 가능하다(Ingress를 활용할 경우).  

서비스와 인그레스의 차이점을 간단하게 설명하면 아래와 같다.

- 서비스는 주로 L4 영역에서 통신시 사용한다.
- 인그레스는 L7에서 통신할 때 사용한다.

이 두가지를 적절히 혼용해서 사용할수 있다.



# 2. 서비스의 대표적인 종류들

- ClusterIP
  - 기본 서비스 타입
  - 쿠버네티스 클러스터 내부에서만 사용가능하다.
  - 클러스터 내부에서는 클러스터 IP를 이용해서 서비스에 연결된 파드에 접근가능하다. 
  - 클러스터 외부에서는 이용불가
- NodePort
  - 서비스 하나에 대해 모든 노드의 지정된 포트를 할당한다.
  - 노드의 포트를 사용하므로 클러스터 내부/외부에서도 접근 가능하다.
  - 클러스터 외부에서 클러스터 내부로 접근할 때 사용하는 가장 단순한 방법
  - 실행되지 않는 노드에도 지정된 포트로 접근하면 알아서 실행되고 있는 노드에 직접 연결해준다.
- LoadBalancer
  - AWS, GCP 와 같은 유명 클라우드 서비스, 오픈스택과 같은 비공개용 클라우드, 쿠버네티스 지원 로드밸런서 장비에서 사용된다.
  - 클라우드에서 제공되는 로드밸런서와 Pod를 연결한 후 로드밸런서의 IP로  클러스터 외부에서 파드에 접근할 수 있도록 해준다.
  - kubectl get service 명령으로 서비스를 확인가능.
  - kubectl get service 명령으로 서비스 상태를 확인하면 EXTERNAL -IP 항목에 로드밸런서 IP를 표시되는데, 이 IP로 클러스터 외부에서 Pod에 접근한다.
- ExternalName
  - .spec.externalName 필드에 설정한 값과 연결한다.
  - 클러스터 내부에서 외부로 접근할 때 사용
  - CNAME을 설정하면 클러스터 CNAME 값으로 클러스터 외부에 접근 가능하다.
  - 클러스터 외부에 접근할 때 사용하기 때문에 셀렉터(.spec.selector)를 명시하지 않아도 된다.



# 3. 서비스 사용하기





